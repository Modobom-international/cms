/*!
 * Users tracking behavior script with live time detection, detailed element interaction, and AI training
 * Copyright 2025 Modobom
 * Licensed under MIT
 */
!function(){"use strict";const e=function(){let e=localStorage.getItem("userUUID");e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),localStorage.setItem("userUUID",e));return e}(),t=window.innerWidth<=768,n=[],o=[];let i,a=0,s=0,r=E(),c=E(),l=0,d=E();function u(){const e=E(),t=e-r,n=navigator.userAgent.toLowerCase(),o=t<50||0===a&&s>10||navigator.webdriver||!window.outerWidth||performance.timing.domInteractive<100,i=[/bot/i,/spider/i,/crawler/i,/slurp/i,/googlebot/i,/bingbot/i,/yandexbot/i,/duckduckbot/i,/baiduspider/i,/facebot/i,/ia_archiver/i,/headless/i].some((e=>e.test(n)))||o;return r=e,i}function m(e){return{tagName:e.tagName,id:e.id||"",classes:e.className?Array.from(e.classList):[],textContent:e.textContent?e.textContent.trim().substring(0,100):"",attributes:w(e),position:{x:e.getBoundingClientRect().left+window.scrollX,y:e.getBoundingClientRect().top+window.scrollY,width:e.offsetWidth,height:e.offsetHeight},parentTag:e.parentElement?e.parentElement.tagName:"",isButton:"BUTTON"===e.tagName||"button"===e.type||e.classList.contains("btn"),isInput:["INPUT","TEXTAREA","SELECT"].includes(e.tagName)}}function w(e){const t={};if(e.attributes)for(let n of e.attributes)t[n.name]=n.value;return t}function g(){b({uuid:e,timestamp:T(),domain:window.location.hostname,path:window.location.pathname+window.location.search,userInfo:y()},"/heartbeat")}function h(e,t,o){u()||n.push({time:o,event:e,data:{...t,screenWidth:window.innerWidth,screenHeight:window.innerHeight,scrollHeight:document.body.scrollHeight||document.documentElement.scrollHeight}})}function f(t,n,i){const r={title:document.title,url:window.location.href,visibleText:document.body.innerText.substring(0,500),elementsCount:document.getElementsByTagName("*").length},d={timestamp:i,eventName:t,eventData:n,userUUID:e,isBot:u(),pageContext:r,session:{startTime:c,timeOnPage:l,mouseMovements:a,keyPresses:s},label:p(t,n)};o.push(d)}function p(e,t){return"click"===e&&t.elementDetails?.isButton?"button_interaction":"click"===e&&t.isInternalLink?"navigation":"click"===e&&t.isLassoButton?"conversion":"keydown"===e&&t.elementDetails?.isInput?"form_interaction":"scroll"===e&&t.scrollTop>500?"content_exploration":"general_interaction"}function v(){const e=E();l+=e-d,d=e}function x(e,t){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout((()=>n=!1),t))}}function b(e,t){let n=function(){const e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://127.0.0.1:8000":"https://api.modobomco.com"}()+t;fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch((e=>console.error("Error:",e)))}function k(t,n){const o=window.location.pathname+window.location.search,i={eventName:t,eventData:n,timestamp:T(),user:y(),domain:window.location.hostname,uuid:e,path:o};u()||b(i)}function y(){return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookiesEnabled:navigator.cookieEnabled,screenWidth:window.screen.width,screenHeight:window.screen.height,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,performance:performance.timing.toJSON()}}function T(){const e=new Date,t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t+252e5).toISOString()}function E(){const e=new Date,t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t+252e5).getTime()}window.addEventListener("load",(()=>{u()||(g(),i=setInterval((()=>{u()?clearInterval(i):g()}),1e4))})),window.addEventListener("focus",(()=>{d=Date.now();const e=T();h("window_focus",{},e),f("window_focus",{},e)})),window.addEventListener("blur",(()=>{v();const e=T();h("window_blur",{},e),f("window_blur",{},e)})),document.addEventListener("click",(e=>{const n=e.target,o=document.body.scrollHeight||document.documentElement.scrollHeight;let i={x:e.pageX,y:e.pageY,elementDetails:m(n),href:n.href||"",isInternalLink:n.href&&n.href.includes(window.location.origin),isLassoButton:n.classList.contains("lasso-button"),lassoButtonLink:n.dataset.lassoLink||"",device:t?"mobile":"desktop",height:o};const a=T();k("click",i),h("click",i,a),f("click",i,a)})),document.addEventListener("mousemove",x((e=>{const n=e.target,o=e.pageX,i=e.pageY,s=t?"mobile":"desktop",r=document.body.scrollHeight||document.documentElement.scrollHeight;a++;const c={x:o,y:i,mouseMovements:a,elementDetails:m(n),device:s,height:r},l=T();k("mousemove",c),h("mousemove",c,l),f("mousemove",c,l)}),100)),document.addEventListener("scroll",x((()=>{const e={scrollTop:window.scrollY,scrollLeft:window.scrollX,device:t?"mobile":"desktop"},n=T();k("scroll",e),h("scroll",e,n),f("scroll",e,n)}),100)),document.addEventListener("keydown",(e=>{s++;const n=e.target,o={elementDetails:m(n),value:n.value||"",key:e.key,device:t?"mobile":"desktop"},i=T();k("keydown",o),h("keydown",o,i),f("keydown",o,i)})),window.addEventListener("beforeunload",(()=>{v(),u()||(clearInterval(i),n.length>0&&b({uuid:e,domain:window.location.hostname,path:window.location.pathname+window.location.search,startTime:c,endTime:E(),totalTime:l,timeline:n,userInfo:y()},"/create-video-timeline"),o.length>0&&b({uuid:e,domain:window.location.hostname,sessionStart:c,sessionEnd:E(),events:o},"/collect-ai-training-data"))}))}();